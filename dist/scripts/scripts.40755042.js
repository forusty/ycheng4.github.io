"use strict";angular.module("wheresmytaxiApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","mapGeoJSONService","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).otherwise({redirectTo:"/"})}]),angular.module("wheresmytaxiApp").controller("MainCtrl",["$scope","testService",function(a,b){var c="",d="";a.currentMode="",b.queryData().success(function(d){console.log(d),b.setData(d),a.currentMode="datapoint",a.totalTaxiCount=b.getData().features[0].geometry.coordinates.length;var e=document.getElementById("map");c=new google.maps.Map(e,{center:{lat:1.3521,lng:103.8198},zoom:11}),c.data.addGeoJson(d);new google.maps.KmlLayer({url:"https://www.dropbox.com/s/svszn361sq0cn5g/speed_camera_spf.kml?dl=1",map:c})}).error(function(a,b){console.log(a),console.log(b),console.log(b)}),a.submit=function(){var b=new google.maps.Geocoder;b.geocode({address:a.geoCode},function(a,b){b===google.maps.GeocoderStatus.OK?(c.setCenter(a[0].geometry.location),c.setZoom(18)):console.log("Geocode was not successful for the following reason: "+b)})},a.heatMap=function(){a.currentMode="heatmap",console.log(),"string"!=typeof d&&d.setMap(null),c.data.forEach(function(a){c.data.remove(a)});var e=[];angular.forEach(b.getData().features[0].geometry.coordinates,function(a){e.push(new google.maps.LatLng(a[1],a[0]))}),d=new google.maps.visualization.HeatmapLayer({data:e}),d.setMap(c)},a.dataPoint=function(){a.currentMode="datapoint","string"!=typeof d&&d.setMap(null),c.data.forEach(function(a){c.data.remove(a)}),c.data.addGeoJson(b.getData())},a.refresh=function(){b.queryData().success(function(c){b.setData(c),console.log(c),"heatmap"===a.currentMode?a.heatMap():"datapoint"===a.currentMode&&a.dataPoint(),a.totalTaxiCount=b.getData().features[0].geometry.coordinates.length}).error(function(a,b){console.log(a),console.log(b),console.log(b)})}}]);var jsonTest=angular.module("mapGeoJSONService",["ngResource"]);jsonTest.factory("testService",["$resource","$http",function(a,b){var c={headers:{"api-key":"x1EBGabWogDOPfCcEPXj1vp4XeHZ7lLh"}},d={},e=function(){var b=a("json/abc.kml",{},{query:{method:"GET",isArray:!1}});return b},f=function(){return b.get("https://api.data.gov.sg/v1/transport/taxi-availability",c)};return{queryDataKML:e,queryData:f,setData:function(a){d=a},getData:function(){return d}}}]),angular.module("wheresmytaxiApp").run(["$templateCache",function(a){a.put("views/main.html",'<div id="floating-panel"> <input id="address" type="textbox" ng-model="geoCode"> <input id="submit" type="button" ng-click="submit()" value="Submit"> <input id="submit" type="button" ng-click="heatMap()" value="Heat Map"> <input id="submit" type="button" ng-click="dataPoint()" value="Data Point"> <input id="submit" type="button" ng-click="refresh()" value="Refresh"> <label>Total Number of Taxi in Operation : {{totalTaxiCount}}</label> </div> <div id="map"> </div>')}]);